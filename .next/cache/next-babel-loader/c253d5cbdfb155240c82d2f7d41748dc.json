{"ast":null,"code":"import 'isomorphic-unfetch';\nimport Prismic from 'prismic-javascript';\nconst REPOSITORY = process.env.NEXT_EXAMPLE_CMS_PRISMIC_REPOSITORY_NAME;\nconst REF_API_URL = `https://${REPOSITORY}.prismic.io/api/v2`;\nconst GRAPHQL_API_URL = `https://${REPOSITORY}.prismic.io/graphql`; // export const API_URL = 'https://your-repo-name.cdn.prismic.io/api/v2'\n\nexport const API_TOKEN = process.env.NEXT_EXAMPLE_CMS_PRISMIC_API_TOKEN;\nexport const PrismicClient = Prismic.client(REF_API_URL, {\n  accessToken: API_TOKEN\n});\n\nasync function fetchAPI(query, {\n  previewData,\n  variables\n} = {}) {\n  const prismicAPI = await PrismicClient.getApi();\n  const res = await fetch(`${GRAPHQL_API_URL}?query=${query}&variables=${JSON.stringify(variables)}`, {\n    headers: {\n      'Prismic-Ref': (previewData === null || previewData === void 0 ? void 0 : previewData.ref) || prismicAPI.masterRef.ref,\n      'Content-Type': 'application/json',\n      Authorization: `Token ${API_TOKEN}`\n    }\n  });\n\n  if (res.status !== 200) {\n    console.log((await res.text()));\n    throw new Error('Failed to fetch API');\n  }\n\n  const json = await res.json();\n\n  if (json.errors) {\n    console.error(json.errors);\n    throw new Error('Failed to fetch API');\n  }\n\n  return json.data;\n}\n\nexport async function getPreviewPostBySlug(slug) {\n  const data = await fetchAPI(`\n    query PostBySlug($slug: String!) {\n      post(uid: $slug, lang: \"en-us\") {\n        _meta {\n          uid\n        }\n      }\n    }`, {\n    preview: true,\n    variables: {\n      slug\n    }\n  });\n  return data === null || data === void 0 ? void 0 : data.post;\n}\nexport async function getAllPostsWithSlug() {\n  var _data$allPosts;\n\n  const data = await fetchAPI(`\n    {\n      allPosts {\n        edges {\n          node {\n            _meta {\n              uid\n            }\n          }\n        }\n      }\n    }\n  `);\n  return data === null || data === void 0 ? void 0 : (_data$allPosts = data.allPosts) === null || _data$allPosts === void 0 ? void 0 : _data$allPosts.edges;\n}\nexport async function getAllPostsForHome(previewData) {\n  const data = await fetchAPI(`\n    query {\n      allPosts(sortBy: date_DESC) {\n        edges {\n          node {\n            date\n            title\n            content\n            coverimage\n            excerpt\n            author {\n              ...on Author {\n                name\n                picture\n              }\n            }\n            _meta {\n              uid\n            }\n          }\n        }\n      }\n    }\n  `, {\n    previewData\n  });\n  return data.allPosts.edges;\n}\nexport async function getPostAndMorePosts(slug, previewData) {\n  const data = await fetchAPI(`\n  query PostBySlug($slug: String!) {\n    post(uid: $slug, lang: \"en-us\") {\n      title\n      content\n      date\n      coverimage\n      author {\n        ...on Author {\n          name\n          picture\n        }\n      }\n      _meta {\n        uid\n      }\n    }\n\n   morePosts: allPosts(sortBy: date_DESC, first: 3) {\n      edges {\n        node {\n          title\n          content\n          date\n          coverimage\n          excerpt\n          author {\n            ...on Author {\n              name\n              picture\n            }\n          }\n          _meta {\n            uid\n          }\n        }\n      }\n    }\n  }\n  `, {\n    previewData,\n    variables: {\n      slug\n    }\n  });\n  data.morePosts = data.morePosts.edges.filter(({\n    node\n  }) => node._meta.uid !== slug).slice(0, 2);\n  return data;\n}","map":{"version":3,"sources":["C:/Users/lucyv/Desktop/fleabag.world/fleabag-world/lib/api.js"],"names":["Prismic","REPOSITORY","process","env","NEXT_EXAMPLE_CMS_PRISMIC_REPOSITORY_NAME","REF_API_URL","GRAPHQL_API_URL","API_TOKEN","NEXT_EXAMPLE_CMS_PRISMIC_API_TOKEN","PrismicClient","client","accessToken","fetchAPI","query","previewData","variables","prismicAPI","getApi","res","fetch","JSON","stringify","headers","ref","masterRef","Authorization","status","console","log","text","Error","json","errors","error","data","getPreviewPostBySlug","slug","preview","post","getAllPostsWithSlug","allPosts","edges","getAllPostsForHome","getPostAndMorePosts","morePosts","filter","node","_meta","uid","slice"],"mappings":"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","sourcesContent":["import 'isomorphic-unfetch'\nimport Prismic from 'prismic-javascript'\n\nconst REPOSITORY = process.env.NEXT_EXAMPLE_CMS_PRISMIC_REPOSITORY_NAME\nconst REF_API_URL = `https://${REPOSITORY}.prismic.io/api/v2`\nconst GRAPHQL_API_URL = `https://${REPOSITORY}.prismic.io/graphql`\n// export const API_URL = 'https://your-repo-name.cdn.prismic.io/api/v2'\nexport const API_TOKEN = process.env.NEXT_EXAMPLE_CMS_PRISMIC_API_TOKEN\n\nexport const PrismicClient = Prismic.client(REF_API_URL, {\n  accessToken: API_TOKEN,\n})\n\nasync function fetchAPI(query, { previewData, variables } = {}) {\n  const prismicAPI = await PrismicClient.getApi()\n  const res = await fetch(\n    `${GRAPHQL_API_URL}?query=${query}&variables=${JSON.stringify(variables)}`,\n    {\n      headers: {\n        'Prismic-Ref': previewData?.ref || prismicAPI.masterRef.ref,\n        'Content-Type': 'application/json',\n        Authorization: `Token ${API_TOKEN}`,\n      },\n    }\n  )\n\n  if (res.status !== 200) {\n    console.log(await res.text())\n    throw new Error('Failed to fetch API')\n  }\n\n  const json = await res.json()\n  if (json.errors) {\n    console.error(json.errors)\n    throw new Error('Failed to fetch API')\n  }\n  return json.data\n}\n\nexport async function getPreviewPostBySlug(slug) {\n  const data = await fetchAPI(\n    `\n    query PostBySlug($slug: String!) {\n      post(uid: $slug, lang: \"en-us\") {\n        _meta {\n          uid\n        }\n      }\n    }`,\n    {\n      preview: true,\n      variables: {\n        slug,\n      },\n    }\n  )\n  return data?.post\n}\n\nexport async function getAllPostsWithSlug() {\n  const data = await fetchAPI(`\n    {\n      allPosts {\n        edges {\n          node {\n            _meta {\n              uid\n            }\n          }\n        }\n      }\n    }\n  `)\n  return data?.allPosts?.edges\n}\n\nexport async function getAllPostsForHome(previewData) {\n  const data = await fetchAPI(\n    `\n    query {\n      allPosts(sortBy: date_DESC) {\n        edges {\n          node {\n            date\n            title\n            content\n            coverimage\n            excerpt\n            author {\n              ...on Author {\n                name\n                picture\n              }\n            }\n            _meta {\n              uid\n            }\n          }\n        }\n      }\n    }\n  `,\n    { previewData }\n  )\n\n  return data.allPosts.edges\n}\n\nexport async function getPostAndMorePosts(slug, previewData) {\n  const data = await fetchAPI(\n    `\n  query PostBySlug($slug: String!) {\n    post(uid: $slug, lang: \"en-us\") {\n      title\n      content\n      date\n      coverimage\n      author {\n        ...on Author {\n          name\n          picture\n        }\n      }\n      _meta {\n        uid\n      }\n    }\n\n   morePosts: allPosts(sortBy: date_DESC, first: 3) {\n      edges {\n        node {\n          title\n          content\n          date\n          coverimage\n          excerpt\n          author {\n            ...on Author {\n              name\n              picture\n            }\n          }\n          _meta {\n            uid\n          }\n        }\n      }\n    }\n  }\n  `,\n    {\n      previewData,\n      variables: {\n        slug,\n      },\n    }\n  )\n\n  data.morePosts = data.morePosts.edges\n    .filter(({ node }) => node._meta.uid !== slug)\n    .slice(0, 2)\n\n  return data\n}\n"]},"metadata":{},"sourceType":"module"}